import fs from 'fs';
import { SAPCPWorkflowCFApi } from '../test/test-util/test-services/openapi/SAP_CP_Workflow_CF';
import { Destination } from './connectivity/scp-cf/destination';

describe('export', () => {
  it('executes request', async () => {
    const token =
      'eyJhbGciOiJSUzI1NiIsImprdSI6Imh0dHBzOi8vY29kZWZsb3ctY29uc3VtZXIxLmF1dGhlbnRpY2F0aW9uLnNhcC5oYW5hLm9uZGVtYW5kLmNvbS90b2tlbl9rZXlzIiwia2lkIjoia2V5LWlkLTEiLCJ0eXAiOiJKV1QifQ.eyJqdGkiOiI3NTM2OGI5YjZhNzQ0ZTBlOWZhZmIyMTVjNjMxZWZiYiIsImV4dF9hdHRyIjp7ImVuaGFuY2VyIjoiWFNVQUEiLCJzdWJhY2NvdW50aWQiOiI5M2E5YjBiMC02ZDMxLTQzZDAtYmU1YS00YTcwMmM5NGVlZGIiLCJ6ZG4iOiJjb2RlZmxvdy1jb25zdW1lcjEiLCJzZXJ2aWNlaW5zdGFuY2VpZCI6Indmcy1hcHAtZm9yLW1hcmlrYSJ9LCJ4cy5zeXN0ZW0uYXR0cmlidXRlcyI6eyJ4cy5yb2xlY29sbGVjdGlvbnMiOlsiU3VwZXJBZG1pbl9mb3ItbWFyaWthIl19LCJnaXZlbl9uYW1lIjoiSnVuamllIiwieHMudXNlci5hdHRyaWJ1dGVzIjp7fSwiZmFtaWx5X25hbWUiOiJUYW5nIiwic3ViIjoiMTliOTRlNjItYWY4Yi00ZWIzLWEzYmEtZTdmZTcxY2JlMGI2Iiwic2NvcGUiOlsid2ZzLWFwcC1mb3ItbWFyaWthIWIyNjUxLldPUktGTE9XX0lOU1RBTkNFX1NUQVJUIiwid2ZzLWFwcC1mb3ItbWFyaWthIWIyNjUxLldPUktGTE9XX0RFRklOSVRJT05fVU5ERVBMT1kiLCJ3ZnMtYXBwLWZvci1tYXJpa2EhYjI2NTEuTUVTU0FHRV9TRU5EIiwid2ZzLWFwcC1mb3ItbWFyaWthIWIyNjUxLkZPUk1fREVGSU5JVElPTl9ERVBMT1kiLCJ3ZnMtYXBwLWZvci1tYXJpa2EhYjI2NTEuQVVUSE9SSVpFX1dJVEhfSU5TVEFOQ0VfUk9MRVMiLCJ3ZnMtYXBwLWZvci1tYXJpa2EhYjI2NTEuUFVSR0VfQVBQX1RFTkFOVCIsIndmcy1hcHAtZm9yLW1hcmlrYSFiMjY1MS5XT1JLRkxPV19ERUZJTklUSU9OX1FVRVJZX0FOWSIsIndmcy1hcHAtZm9yLW1hcmlrYSFiMjY1MS5XT1JLRkxPV19JTlNUQU5DRVNfUEFUQ0giLCJ3ZnMtYXBwLWZvci1tYXJpa2EhYjI2NTEuV09SS0ZMT1dfSU5TVEFOQ0VfVVBEQVRFX0FUVEFDSE1FTlRTIiwid2ZzLWFwcC1mb3ItbWFyaWthIWIyNjUxLlBST0NFU1NfVkFSSUFOVF9ERUxFVEUiLCJ3ZnMtYXBwLWZvci1tYXJpa2EhYjI2NTEuV09SS0ZMT1dfSU5TVEFOQ0VfU1VTUEVORCIsIndmcy1hcHAtZm9yLW1hcmlrYSFiMjY1MS5FVkVOVF9TVUJTQ1JJUFRJT05fQ1JFQVRFIiwid2ZzLWFwcC1mb3ItbWFyaWthIWIyNjUxLkZPUk1fREVGSU5JVElPTl9VTkRFUExPWSIsIm9wZW5pZCIsIndmcy1hcHAtZm9yLW1hcmlrYSFiMjY1MS5XT1JLRkxPV19JTlNUQU5DRV9RVUVSWV9ST0xFUyIsIndmcy1hcHAtZm9yLW1hcmlrYSFiMjY1MS5XT1JLRkxPV19JTlNUQU5DRV9HRVRfQVRUQUNITUVOVFMiLCJ3ZnMtYXBwLWZvci1tYXJpa2EhYjI2NTEuUkVBRF9GRUFUVVJFX0ZMQUdTIiwid2ZzLWFwcC1mb3ItbWFyaWthIWIyNjUxLkpPQl9TVEFUVVNfUVVFUlkiLCJ3ZnMtYXBwLWZvci1tYXJpa2EhYjI2NTEuVEFTS19ERUZJTklUSU9OX1FVRVJZX0FOWSIsIndmcy1hcHAtZm9yLW1hcmlrYSFiMjY1MS5UQVNLX01BTkFHRV9PV04iLCJ1YWEudXNlciIsIndmcy1hcHAtZm9yLW1hcmlrYSFiMjY1MS5EQVRBX0VYUE9SVCIsIndmcy1hcHAtZm9yLW1hcmlrYSFiMjY1MS5JTVBFUlNPTkFUSU9OX1RPS0VOX0dFVCIsIndmcy1hcHAtZm9yLW1hcmlrYSFiMjY1MS5XT1JLRkxPV19JTlNUQU5DRV9DQU5DRUwiLCJ3ZnMtYXBwLWZvci1tYXJpa2EhYjI2NTEuVEFTS19HRVRfQVRUQUNITUVOVFMiLCJ3ZnMtYXBwLWZvci1tYXJpa2EhYjI2NTEuV09SS0ZMT1dfSU5TVEFOQ0VfUkVUUllfUkVTVU1FIiwid2ZzLWFwcC1mb3ItbWFyaWthIWIyNjUxLlRBU0tfUVVFUllfQU5ZIiwid2ZzLWFwcC1mb3ItbWFyaWthIWIyNjUxLlRBU0tfR0VUX0ZPUk0iLCJ3ZnMtYXBwLWZvci1tYXJpa2EhYjI2NTEuUFJPQ0VTU19WQVJJQU5UX0dFVCIsIndmcy1hcHAtZm9yLW1hcmlrYSFiMjY1MS5UQVNLX0dFVF9DT05URVhUX0FOWSIsIndmcy1hcHAtZm9yLW1hcmlrYSFiMjY1MS5XT1JLRkxPV19JTlNUQU5DRV9RVUVSWV9FWEVDVVRJT05fTE9HUyIsIndmcy1hcHAtZm9yLW1hcmlrYSFiMjY1MS5UQVNLX1BBVENIX0FOWSIsIndmcy1hcHAtZm9yLW1hcmlrYSFiMjY1MS5XT1JLRkxPV19ERUZJTklUSU9OX0RFUExPWSIsIndmcy1hcHAtZm9yLW1hcmlrYSFiMjY1MS5XT1JLRkxPV19JTlNUQU5DRV9HRVRfQ09OVEVYVCIsIndmcy1hcHAtZm9yLW1hcmlrYSFiMjY1MS5QUk9DRVNTX1ZBUklBTlRfQUNUSVZBVEUiLCJ3ZnMtYXBwLWZvci1tYXJpa2EhYjI2NTEuRk9STV9ERUZJTklUSU9OX0dFVF9NT0RFTF9TVEFSVCIsIndmcy1hcHAtZm9yLW1hcmlrYSFiMjY1MS5UQVNLX0NPTVBMRVRFX0FOWSIsIndmcy1hcHAtZm9yLW1hcmlrYSFiMjY1MS5XT1JLRkxPV19JTlNUQU5DRV9FUlJPUl9NRVNTQUdFU19RVUVSWSIsIndmcy1hcHAtZm9yLW1hcmlrYSFiMjY1MS5XT1JLRkxPV19ERUZJTklUSU9OX1ZBTElEQVRFIiwid2ZzLWFwcC1mb3ItbWFyaWthIWIyNjUxLkVWRU5UX1NVQlNDUklQVElPTl9RVUVSWV9BTlkiLCJ3ZnMtYXBwLWZvci1tYXJpa2EhYjI2NTEuRVZFTlRfU1VCU0NSSVBUSU9OX1BBVENIIiwid2ZzLWFwcC1mb3ItbWFyaWthIWIyNjUxLlJFVFJJRVZFX1hTUkZfVE9LRU4iLCJ3ZnMtYXBwLWZvci1tYXJpa2EhYjI2NTEuUFJPQ0VTU19URU1QTEFURV9HRVQiLCJ3ZnMtYXBwLWZvci1tYXJpa2EhYjI2NTEuRk9STV9ERUZJTklUSU9OX0dFVCIsIndmcy1hcHAtZm9yLW1hcmlrYSFiMjY1MS5QUk9DRVNTX1RFTVBMQVRFX0RFTEVURSIsIndmcy1hcHAtZm9yLW1hcmlrYSFiMjY1MS5XT1JLRkxPV19ERUZJTklUSU9OX0dFVF9NT0RFTCIsIndmcy1hcHAtZm9yLW1hcmlrYSFiMjY1MS5QUk9DRVNTX1ZBUklBTlRfREVQTE9ZIiwid2ZzLWFwcC1mb3ItbWFyaWthIWIyNjUxLkVWRU5UX1NVQlNDUklQVElPTl9ERUxFVEUiLCJ3ZnMtYXBwLWZvci1tYXJpa2EhYjI2NTEuV09SS0ZMT1dfREVGSU5JVElPTl9HRVRfU0FNUExFX0NPTlRFWFQiLCJ3ZnMtYXBwLWZvci1tYXJpa2EhYjI2NTEuV09SS0ZMT1dfSU5TVEFOQ0VfR0VUX0FUVFJJQlVURVMiLCJ3ZnMtYXBwLWZvci1tYXJpa2EhYjI2NTEuRk9STV9ERUZJTklUSU9OX0dFVF9NT0RFTF9BTlkiLCJ3ZnMtYXBwLWZvci1tYXJpa2EhYjI2NTEuVEFTS19HRVRfQVRUUklCVVRFU19BTlkiLCJ3ZnMtYXBwLWZvci1tYXJpa2EhYjI2NTEuUFJPQ0VTU19URU1QTEFURV9HRVRfTU9ERUwiLCJ3ZnMtYXBwLWZvci1tYXJpa2EhYjI2NTEuV09SS0ZMT1dfSU5TVEFOQ0VfVVBEQVRFX1JPTEVTIiwid2ZzLWFwcC1mb3ItbWFyaWthIWIyNjUxLkZPUk1fREVGSU5JVElPTl9HRVRfTU9ERUwiLCJ3ZnMtYXBwLWZvci1tYXJpa2EhYjI2NTEuV09SS0ZMT1dfSU5TVEFOQ0VfVVBEQVRFX0NPTlRFWFQiLCJ3ZnMtYXBwLWZvci1tYXJpa2EhYjI2NTEuVEFTS19HRVRfRk9STV9NT0RFTCIsIndmcy1hcHAtZm9yLW1hcmlrYSFiMjY1MS5XT1JLRkxPV19JTlNUQU5DRV9RVUVSWV9BTlkiXSwiY2xpZW50X2lkIjoic2ItY2xvbmUtd2ZzLWFwcC1mb3ItbWFyaWthIWIyNjY3fHdmcy1hcHAtZm9yLW1hcmlrYSFiMjY1MSIsImNpZCI6InNiLWNsb25lLXdmcy1hcHAtZm9yLW1hcmlrYSFiMjY2N3x3ZnMtYXBwLWZvci1tYXJpa2EhYjI2NTEiLCJhenAiOiJzYi1jbG9uZS13ZnMtYXBwLWZvci1tYXJpa2EhYjI2Njd8d2ZzLWFwcC1mb3ItbWFyaWthIWIyNjUxIiwiZ3JhbnRfdHlwZSI6InBhc3N3b3JkIiwidXNlcl9pZCI6IjE5Yjk0ZTYyLWFmOGItNGViMy1hM2JhLWU3ZmU3MWNiZTBiNiIsIm9yaWdpbiI6ImxkYXAiLCJ1c2VyX25hbWUiOiJqdW5qaWUudGFuZ0BzYXAuY29tIiwiZW1haWwiOiJqdW5qaWUudGFuZ0BzYXAuY29tIiwiYXV0aF90aW1lIjoxNjExNzYzOTgyLCJyZXZfc2lnIjoiM2Q2M2UzMWIiLCJpYXQiOjE2MTE3NjM5ODIsImV4cCI6MTYxMTgwNzE4MiwiaXNzIjoiaHR0cDovL2NvZGVmbG93LWNvbnN1bWVyMS5sb2NhbGhvc3Q6ODA4MC91YWEvb2F1dGgvdG9rZW4iLCJ6aWQiOiI5M2E5YjBiMC02ZDMxLTQzZDAtYmU1YS00YTcwMmM5NGVlZGIiLCJhdWQiOlsic2ItY2xvbmUtd2ZzLWFwcC1mb3ItbWFyaWthIWIyNjY3fHdmcy1hcHAtZm9yLW1hcmlrYSFiMjY1MSIsInVhYSIsIm9wZW5pZCIsIndmcy1hcHAtZm9yLW1hcmlrYSFiMjY1MSJdfQ.d068_HnsFmHwp-U-NMb7P064LZMkz5HtNQq2Vn-llT2InrU1MbMulcugXfNbgH2q5EEXHOZtfW4r-knEWR49G76z6Ay7OLp3uLOtVi3Xux_buG7YTfq2EEbI-1TgnG08-n-TEVnbJKUlHTrXG9Od5bHzZtn9bYISPYlVb2cpRFUtQUicDOV7ruLltFbwysWg-Fh5fi9zSb6rIrFAx3wKYTMj08gTP_v_80SBKkRnLdCfFoSnm6cWgw50XC-wqwCJL5zy7VdyDYsD78B90uckPYdU3kRDYybt792f9nA0Zp3lpT57pPrJmhiHkY4kKBWea8QRPrZpoMOQUc8swPEdMw';
    const dest: Destination = {
      url:
        'https://wfs-app-for-marika.internal.cfapps.sap.hana.ondemand.com/workflow-service/rest'
    };
    const authHeader = { Authorization: `Bearer ${token}` };
    const endpoint =
      'https://wfs-app-for-marika.internal.cfapps.sap.hana.ondemand.com/workflow-service/rest/v1/export';
    try {
      // get workflow definition test
      const res1 = await SAPCPWorkflowCFApi.getV1WorkflowDefinitions()
        .addCustomHeaders(authHeader)
        .executeRaw(dest);
      expect(res1.status).toEqual(200);
      expect(res1.data).toEqual([]);

      // raw axios test
      // const axiosConfig: AxiosRequestConfig = {
      //   method: 'get',
      //   url: endpoint,
      //   headers: authHeader,
      //   responseType: 'arraybuffer'
      // };
      // const axiosRes = await axios.request(axiosConfig);
      // fs.writeFileSync('./e0.zip', axiosRes.data);

      //
      const res2 = await SAPCPWorkflowCFApi.getV1Export()
        .addCustomHeaders(authHeader)
        .executeRaw(dest, { responseType: 'arraybuffer' });
      console.log(res2.status);
      console.log(res2.data);

      fs.writeFileSync('./e1.zip', res2.data);

    } catch (err) {
      console.error(err);
    }
  });
});
